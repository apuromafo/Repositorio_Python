# -*- coding: utf-8 -*-
# Script que guía los pasos recomendados para generar informes de Pentesting
# utilizando Markdown (MD), recomendando Obsidian y la integración con GitHub.

import sys
# Códigos ANSI para colores y formatos
class Colors:
    BLUE = "\033[94m"
    GREEN = "\033[92m"
    RED = "\033[91m"
    YELLOW = "\033[93m"
    END = "\033[0m"
    BOLD = "\033[1m"
    HEADER = BOLD + BLUE
    SUCCESS = BOLD + GREEN
    WARNING = YELLOW
    DANGER = BOLD + RED

# Función para imprimir una sección con formato
def print_section(title):
    print(f"\n{Colors.HEADER}--- {title.upper()} ---{Colors.END}")

# Función principal
def run_pentest_guide():
    """Ejecuta la guía estructurada para la generación de informes de Pentesting con MD."""
    
    # --- Encabezado ---
    print(f"{Colors.HEADER}\n*************************************************************{Colors.END}")
    print(f"{Colors.HEADER}⚛️ GUÍA INFORMES DE PENTESTING CON MARKDOWN (MD) ⚛️{Colors.END}")
    print(f"{Colors.HEADER}*************************************************************{Colors.END}")
    print(f"{Colors.WARNING}Markdown ofrece velocidad y portabilidad, ideal para notas técnicas rápidas y estructuradas.{Colors.END}")

    # --- HERRAMIENTAS CLAVE ---
    print_section("HERRAMIENTAS CLAVE")
    print(f"{Colors.BOLD}1. Editor Principal (Recomendado):{Colors.END}")
    print(f"       {Colors.SUCCESS}✅ OBSIDIAN:{Colors.END} Excelente para vincular notas de hallazgos (Knowledge Graph) y previsualizar Markdown.{Colors.END}")
    print(f"{Colors.BOLD}2. Control de Versiones:{Colors.END}")
    print(f"       {Colors.SUCCESS}✅ GITHUB/GITLAB (GIT):{Colors.END} Permite versionar, colaborar y auditar cambios. Ideal para informes técnicos.{Colors.END}")
    print(f"{Colors.BOLD}3. Conversión Final:{Colors.END}")
    print(f"       {Colors.SUCCESS}✅ PANDOC:{Colors.END} Herramienta indispensable para convertir el .md final a PDF, DOCX o HTML, manteniendo la estructura.{Colors.END}")
    
    # --- PASO 1: ESTRUCTURA Y SINTAXIS ---
    print_section("PASO 1: ESTRUCTURA DE CONTENIDO Y MARKDOWN ESTÁNDAR")

    print(f"{Colors.BOLD}1.1 -> Definir la Estructura de Encabezados (Jerarquía).{Colors.END}")
    print(f"       {Colors.WARNING}Usa los encabezados MD (#, ##, ###) consistentemente; son la base para el Índice (TOC) del informe final.{Colors.END}")
    print(f"       {Colors.SUCCESS}SINTAXIS: #Título Principal, ##Sección, ###Hallazgo.{Colors.END}")

    print(f"{Colors.BOLD}\n1.2 -> Manejar el Contenido Técnico (Bloques de Código).{Colors.END}")
    print(f"       {Colors.WARNING}Usa los bloques de código con resaltado de sintaxis (fenced code blocks) para comandos, scripts o código vulnerable.{Colors.END}")
    print(f"       {Colors.SUCCESS}SINTAXIS: ```lenguaje_usado\\n...código...\\n```{Colors.END}")

    print(f"{Colors.BOLD}\n1.3 -> Insertar Imágenes (Evidencia).{Colors.END}")
    print(f"       {Colors.WARNING}Las imágenes deben guardarse en una subcarpeta (ej: /assets) y enlazarse con rutas relativas.{Colors.END}")
    print(f"       {Colors.SUCCESS}SINTAXIS ESTÁNDAR (MD/Obsidian/Pandoc): ![Pie de Imagen](./assets/captura.png){Colors.END}")

    # --- PASO 2: COMPATIBILIDAD Y TRABAJO EN EQUIPO ---
    print_section("PASO 2: COMPATIBILIDAD OBSIDIAN, GITHUB Y GESTIÓN DE RIESGOS")

    print(f"{Colors.BOLD}2.1 -> ¡Cuidado con las Diferencias de Sintaxis!{Colors.END}")
    print(f"       {Colors.DANGER}❗ NOTA CRÍTICA:{Colors.END} La sintaxis de {Colors.BOLD}enlaces internos e imágenes{Colors.END} puede variar entre Obsidian y GitHub Wiki.")
    print(f"       {Colors.WARNING}   - ENLACE DE PÁGINAS:{Colors.END}")
    print(f"          {Colors.GREEN}Obsidian (MD): [[page|custom display text]]{Colors.END}")
    print(f"          {Colors.RED}GitHub Wiki: [[custom display text|page]]{Colors.END}")
    print(f"       {Colors.WARNING}   - IMÁGENES (Obsidian/Wiki, no MD estándar):{Colors.END}")
    print(f"          {Colors.GREEN}Obsidian: ![[img.png]]{Colors.END}")
    print(f"          {Colors.RED}GitHub Wiki: [[img.png]]{Colors.END}")
    print(f"       {Colors.BOLD}    => RECOMENDACIÓN:{Colors.END} Para máxima portabilidad y conversión con Pandoc, {Colors.BOLD}usa la SINTAXIS ESTÁNDAR de Markdown (1.3){Colors.END} siempre que sea posible.")

    print(f"{Colors.BOLD}\n2.2 -> Control de Versiones con Git.{Colors.END}")
    print(f"       {Colors.WARNING}Almacenar el informe (.md y /assets) en un repositorio Git garantiza historial de cambios, backups y colaboración controlada.{Colors.END}")
    print(f"       {Colors.SUCCESS}FLUJO DE TRABAJO: Crear rama para cambios, hacer 'commit' de hallazgos, 'pull request' para revisión.{Colors.END}")

    print(f"{Colors.BOLD}\n2.3 -> Revisión y Calidad.{Colors.END}")
    print(f"       {Colors.DANGER}❗ PRECAUCIÓN: Markdown es sencillo pero estricto. Un formato incorrecto (espacios, saltos) puede romper la sintaxis al convertir a PDF.{Colors.END}")
    print(f"       {Colors.SUCCESS}REVISIÓN: Siempre previsualiza el .md en Obsidian o en GitHub antes de la conversión final.{Colors.END}")


    # --- PASO 3: CONVERSIÓN Y ENTREGA FINAL ---
    print_section("PASO 3: CONVERSIÓN FINAL CON PANDOC")

    print(f"{Colors.BOLD}3.1 -> Compilar a Formato de Entrega (PDF/DOCX).{Colors.END}")
    print(f"       {Colors.WARNING}Pandoc usa la estructura de encabezados (TOC) y las referencias a imágenes para crear un informe con formato. Considera usar plantillas ({Colors.BOLD}templates{Colors.END}) para un diseño profesional.{Colors.END}")
    print(f"       {Colors.SUCCESS}COMANDO BÁSICO (PDF): pandoc mi_informe.md -o informe_final.pdf{Colors.END}")
    print(f"       {Colors.SUCCESS}COMANDO BÁSICO (DOCX): pandoc mi_informe.md -o informe_final.docx{Colors.END}")
    print(f"       {Colors.SUCCESS}COMANDO CON METADATOS Y TOC: pandoc mi_informe.md -s -o informe.pdf --toc --metadata-file=metadata.yaml{Colors.END}")

    print(f"\n{Colors.SUCCESS}¡Markdown y Obsidian te dan velocidad; GitHub y Pandoc te dan control y calidad final!{Colors.END}")

if __name__ == "__main__":
    try:
        run_pentest_guide()
    except KeyboardInterrupt:
        print(f"\n{Colors.RED}Guía interrumpida por el usuario.{Colors.END}")
        sys.exit(0)